<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WTF - Weather, Food and Travel</title>
    <link rel="stylesheet" href="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
    #map {
    height: 400px;
    width: 80%;
    margin: 30px auto;
    }
    </style>
  </head>
  <body>

    <!-- Start Top Bar -->
    <div class="top-bar">
      <div class="top-bar-left">
        <ul class="menu">
          <li class="menu-text"></li>
          <li><a href="#">Weather</a></li>
          <li><a href="#">Food</a></li>
          <li><a href="#">Travel</a></li>
        </ul>
      </div>
    </div>
    <!-- End Top Bar -->

    <div class="callout large primary">
      <div class="row column text-center">
        <h1>WTF</h1>
        <h2 class="subheader">Weather and Food for Travel</h2>
      </div>
    </div>

    <!-- We can now combine rows and columns when there's only one column in that row -->
    <div class="row medium-8 large-7 columns">
      <div class="blog-post text-center">
        <div id="map"></div>
        <input id="search" type="text" placeholder="Enter a location in the following format: City, State">
        <button id="destination" type="button" class="primary button round">Search Destination</button>
        <p><button id="find" type="button" class="success button round">Current Location</button></p>
      </div>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.js"></script>
   
<script>
var gLat;
var gLong;

$("#destination").click(function(){alert("button has been pressed");
var a = $("#search").val();
var c = a.indexOf(",");
var d = a.substr(0,c);
var e = a.substr(c+2,a.length);
var f = d+","+e;
alert(f);

var zip = "22030";
var APIKey = "5142591fdf2a45c9927600243a8834f2";

var queryURL =  "https://api.weatherbit.io/v2.0/forecast/daily?city="+f+"&country=US&units=i&key=" + APIKey;

$.ajax({
    url: queryURL,
    method: "GET"
})

    .then(function(response) {
        console.log(response);

        var lat = response.lat;
        console.log(lat);

        var lon = response.lon;
        console.log(lon);

        localStorage.setItem("lattitude", JSON.stringify(lat));
        localStorage.setItem("longitude", JSON.stringify(lon));

        GetAddress (lat, lon);

    // let location = new Object();
    // navigator.geolocation.getCurrentPosition(function(pos) {
    // location.lat = lat;
    // gLat = location.lat;
    // location.long = lon;
    // gLong = location.long;
    // map = new google.maps.Map(document.getElementById("map"), {
    //     center: { lat: location.lat, lng: location.long },
    //     zoom: 16,
    // });
    currentLat = lat;
    currentLong = lon;
    let currentLocation = { lat: location.lat, lng: location.long };
    let marker = new google.maps.Marker({
        position: currentLocation,
        map: map
    });

    // google.maps.event.addListener(search, 'places_changed', function() {
    // document.getElementById("destination").onclick = function () {
    // var input = document.getElementById("search");

    // google.maps.event.trigger(input, "focus", {});
    // google.maps.event.trigger(input, "keydown", { keyCode: 13 });
    // google.maps.event.trigger(this, "focus", {});
    }
    )
});

$("#find").click(function(){initMap()});
function initMap() {
let location = new Object();
navigator.geolocation.getCurrentPosition(function(pos) {
    location.lat = pos.coords.latitude;
    gLat = location.lat;
    location.long = pos.coords.longitude;
    gLong = location.long;
    map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: location.lat, lng: location.long },
        zoom: 16,
    });
    currentLat = location.lat;
    currentLong = location.long;
    let currentLocation = { lat: location.lat, lng: location.long };
    let marker = new google.maps.Marker({
        position: currentLocation,
        map: map
    });

    google.maps.event.addListener(search, 'places_changed', function() {
    document.getElementById("destination").onclick = function () {
    var input = document.getElementById("search");

    google.maps.event.trigger(input, "focus", {});
    google.maps.event.trigger(input, "keydown", { keyCode: 13 });
    google.maps.event.trigger(this, "focus", {});
    }

});   
});
}

function GetAddress(lat, lng) {
    // var lat = gLat;
    // var lng = gLong;
    var apiKey = "AIzaSyAriXxPMt_ogYg9aHln6QbvoT0FZxW0_og";
    var url = "https://maps.googleapis.com/maps/api/geocode/json?latlng=" + lat + "," + lng + "&key=" + apiKey;
    $.getJSON(url,function (data, textStatus) {
           var streetaddress=data.results[0].formatted_address;
            // console.log (streetaddress);
            console.log (data);
          localStorage.setItem ("zipCode",data.results[0].address_components[7].short_name);
        
        });
    }

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBs0DXvW7g88kD3-OS7i4HXHzl_oPAP1LQ&callback=initMap">
    </script>
    //  <!-- <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAriXxPMt_ogYg9aHln6QbvoT0FZxW0_og&callback=GetAddress"
    // //  async defer></script> -->
  </body>
</html>



